import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.util.HashMap;
import java.util.Map;

/**
 * The {@code RoomDataExtractor} class provides utilities for extracting specific 
 * metrics from a JSON string, including temperature, humidity, and CO2 levels.
 * 
 * <p>It uses regular expressions to parse the JSON and retrieve numeric values associated 
 * with specific keys.</p>
 * 
 * @version 1.0
 * @since 2023
 * @author 
 *     Jules Giard--Pellat
 */
public class RoomDataExtractor {



    /**
     * Extracts a specific metric value from a JSON string based on the provided key.
     * 
     * <p>The method uses a regular expression to search for the key and its corresponding 
     * numeric value. If the key is not found, it logs an error and returns a default value 
     * of 0.0.</p>
     * 
     * @param jsonString the JSON string containing the metrics.
     * @param key the key for the metric to extract.
     * @return the extracted metric value as a double, or 0.0 if the key is not found.
     */
    public static double extractValue(String jsonString, String key) {
        String regex = "\"" + key + "\":\\[(\\d+\\.\\d+)";
        Pattern pattern = Pattern.compile(regex);
        Matcher matcher = pattern.matcher(jsonString);

        if (matcher.find()) {
            return Double.parseDouble(matcher.group(1)); // Extract and convert to double
        } else {
            System.err.println("Value for key '" + key + "' not found");
            return 0.0; // Default value
        }
    }

        /**
     * Extracts common room metrics (temperature, humidity, and CO2 levels) from a JSON string.
     * 
     * <p>This method aggregates the extracted values for predefined keys and stores them in 
     * a {@code Map} where the keys are the metric names and the values are their respective 
     * numeric values.</p>
     * 
     * @param jsonString the JSON string containing the room's metrics.
     * @return a {@code Map} containing the extracted metrics and their values.
     */
    public static Map<String, Double> extractRoomMetrics(String jsonString) {
        Map<String, Double> metrics = new HashMap<>();
        metrics.put("temperature", extractValue(jsonString, "temperature"));
        metrics.put("humidity", extractValue(jsonString, "humidity"));
        metrics.put("co2", extractValue(jsonString, "co2"));
        return metrics;
    }


}
